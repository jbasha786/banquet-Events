on:
  push:
    branches:
      - feature/28500
  pull_request:
    branches:
      - feature/28500

jobs:
  sonarqube:
    runs-on: windows-latest 
    
    steps:
      # Check out the code
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Set up Node.js for Angular 17
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '17.x'  # Ensure you're using a Node.js version compatible with Angular 17

      # Install dependencies
      - name: Install dependencies
        run: npm install

      # Build the Angular project (needed for test coverage generation)
      - name: Build Angular Project
        run: ng build --prod

      # Run tests and generate code coverage report
      - name: Run tests and generate coverage
        run: ng test --code-coverage --watch=false

      # Install SonarQube scanner
      - name: Install SonarQube scanner
        run: npm install -g sonar-scanner

      # Run SonarQube scan
      - name: Run SonarQube scan
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        run: |
          sonar-scanner \
            -Dsonar.projectKey=Banquet-events \
            -Dsonar.projectName=Banquet-events \
            -Dsonar.projectVersion=1.0 \
            -Dsonar.sources=src/app \
            -Dsonar.javascript.lcov.reportPaths=coverage/lcov-report/index-lcov-report.json \
            -Dsonar.host.url=http://localhost:9000 \
            -Dsonar.login=sqp_3fea249b5cad4639b74f6bb8348085056fa8ce82
